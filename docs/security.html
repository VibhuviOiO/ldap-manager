<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PX6NFGMV');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security - LDAP Manager</title>
    <meta name="description" content="Security features and best practices for LDAP Manager: encrypted password storage, LDAP injection protection, CORS security, and secure deployment.">
    <meta name="keywords" content="ldap security, password encryption, ldap injection, cors security, fernet encryption">
    <link rel="canonical" href="https://vibhuvioio.com/ldap-manager/security.html">
    <link rel="icon" type="image/x-icon" href="img/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="docs.css">
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PX6NFGMV"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="nav-brand" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 12px;">
                <img src="img/ldap.png" alt="LDAP Manager" style="height: 40px; width: auto;">
                <span class="brand-name">LDAP Manager</span>
            </a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="getting-started.html">Docs</a>
                <a href="https://github.com/VibhuviOiO/ldap-manager" target="_blank">GitHub</a>
            </div>
        </div>
    </nav>

    <div class="docs-layout">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h3>Getting Started</h3>
                    <a href="getting-started.html">Installation</a>
                    <a href="configuration.html">Configuration</a>
                </div>
                <div class="nav-section">
                    <h3>Features</h3>
                    <a href="features.html">Overview</a>
                    <a href="security.html" class="active">Security</a>
                </div>
                <div class="nav-section">
                    <h3>Deployment</h3>
                    <a href="production.html">Production Guide</a>
                </div>
                <div class="nav-section">
                    <h3>Contributing</h3>
                    <a href="development.html">Development</a>
                    <a href="testing.html">Testing Guide</a>
                </div>
            </nav>
        </aside>

        <main class="docs-content">
            <h1>Security Features</h1>
            <p>LDAP Manager implements enterprise-grade security features to protect your directory credentials and prevent common attacks.</p>

            <div class="note" style="background: #d4edda; border-left: 4px solid #28a745; padding: 16px; margin: 24px 0;">
                <strong>âœ… Zero Critical Vulnerabilities:</strong> All security features have been audited and tested.
            </div>

            <h2>1. Encrypted Password Storage</h2>

            <h3>Overview</h3>
            <p>LDAP bind passwords are never stored in plaintext. All passwords are encrypted at rest using Fernet symmetric encryption with automatic TTL expiration.</p>

            <h3>Technical Details</h3>
            <ul>
                <li><strong>Algorithm:</strong> Fernet (AES-128-CBC + HMAC)</li>
                <li><strong>Key Generation:</strong> Cryptographically secure random key generated once</li>
                <li><strong>Key Storage:</strong> <code>/app/.secrets/encryption.key</code> with 0600 permissions</li>
                <li><strong>Cache Location:</strong> <code>/app/.cache/</code> with 0700 directory permissions</li>
                <li><strong>File Permissions:</strong> 0600 (read/write owner only)</li>
                <li><strong>TTL:</strong> 1 hour default (3600 seconds)</li>
            </ul>

            <h3>How It Works</h3>
            <ol>
                <li>User enters password in browser</li>
                <li>Password sent via HTTPS to backend</li>
                <li>Backend verifies password with LDAP server</li>
                <li>On success, password encrypted with Fernet and stored</li>
                <li>Encrypted cache includes timestamp and TTL</li>
                <li>On subsequent requests, password decrypted from cache</li>
                <li>Expired passwords automatically deleted</li>
            </ol>

            <h3>Storage Format</h3>
            <pre><code>{
  "cluster": "production-ldap",
  "bind_dn": "cn=Manager,dc=example,dc=com",
  "encrypted_password": "gAAAAABl...encrypted_blob...",
  "timestamp": 1705843200.123,
  "ttl": 3600
}</code></pre>

            <h3>Security Properties</h3>
            <ul>
                <li>âœ… Passwords never logged</li>
                <li>âœ… Passwords never transmitted in plaintext</li>
                <li>âœ… Passwords encrypted at rest</li>
                <li>âœ… Automatic expiration prevents stale credentials</li>
                <li>âœ… File permissions prevent unauthorized access</li>
                <li>âœ… Each cluster has separate encrypted cache file</li>
            </ul>

            <h2>2. LDAP Injection Protection</h2>

            <h3>Overview</h3>
            <p>All user input used in LDAP search filters is sanitized and escaped to prevent LDAP filter injection attacks.</p>

            <h3>Attack Vector Example</h3>
            <p><strong>Without Protection:</strong></p>
            <pre><code>User input: *)(objectClass=*
Search filter: (|(uid=*)(objectClass=*)(cn=...))
Result: Bypass intended filter, return ALL entries</code></pre>

            <p><strong>With Protection:</strong></p>
            <pre><code>User input: *)(objectClass=*
After escaping: \2a\29\28objectClass=\2a
Search filter: (|(uid=\2a\29\28objectClass=\2a)(cn=...))
Result: Harmless literal search for that exact string</code></pre>

            <h3>Implementation</h3>
            <p>Uses Python's <code>ldap.filter.escape_filter_chars()</code> which escapes all special LDAP filter characters:</p>
            <ul>
                <li><code>*</code> â†’ <code>\2a</code></li>
                <li><code>(</code> â†’ <code>\28</code></li>
                <li><code>)</code> â†’ <code>\29</code></li>
                <li><code>\</code> â†’ <code>\5c</code></li>
                <li><code>/</code> â†’ <code>\2f</code></li>
                <li>NUL â†’ <code>\00</code></li>
            </ul>

            <h3>Protected Endpoints</h3>
            <ul>
                <li>âœ… <code>/api/entries/search</code> - Search query parameter</li>
                <li>âœ… <code>/api/entries/create</code> - DN components</li>
                <li>âœ… <code>/api/entries/update</code> - DN and attribute values</li>
                <li>âœ… All user-provided LDAP filter input</li>
            </ul>

            <h2>3. CORS Security</h2>

            <h3>Overview</h3>
            <p>Cross-Origin Resource Sharing (CORS) is configured with strict origin whitelisting to prevent unauthorized cross-site requests.</p>

            <h3>Configuration</h3>
            <p>Set allowed origins via environment variable:</p>
            <pre><code>ALLOWED_ORIGINS=https://ldap.company.com,https://ldap-backup.company.com</code></pre>

            <h3>Default Behavior</h3>
            <ul>
                <li><strong>Development:</strong> <code>http://localhost:5173</code> (Vite dev server)</li>
                <li><strong>Production:</strong> Must be explicitly configured</li>
                <li><strong>Never use:</strong> <code>*</code> (wildcard) in production</li>
            </ul>

            <h3>Security Properties</h3>
            <ul>
                <li>âœ… Only whitelisted origins can make API requests</li>
                <li>âœ… Credentials (cookies) only sent to allowed origins</li>
                <li>âœ… Prevents CSRF attacks from malicious sites</li>
                <li>âœ… Configurable per environment</li>
            </ul>

            <h2>4. Container Security</h2>

            <h3>Non-Root User</h3>
            <p>Container runs as dedicated non-root user:</p>
            <pre><code># User: ldapmanager
# UID: 1000
# Home: /app</code></pre>

            <p><strong>Why This Matters:</strong></p>
            <ul>
                <li>Limits damage from container breakout attacks</li>
                <li>Prevents privilege escalation</li>
                <li>Best practice for production containers</li>
            </ul>

            <h3>File System Permissions</h3>
            <pre><code>/app/.cache/      â†’ 0700 (rwx------)  # Cache directory
/app/.cache/*.json â†’ 0600 (rw-------)  # Encrypted password files
/app/.secrets/     â†’ 0700 (rwx------)  # Secrets directory
/app/.secrets/encryption.key â†’ 0600   # Encryption key</code></pre>

            <h3>Security Options</h3>
            <pre><code>security_opt:
  - no-new-privileges:true  # Prevents privilege escalation</code></pre>

            <h2>5. Input Validation</h2>

            <h3>Configuration Validation</h3>
            <p>All configuration is validated at startup using Pydantic schemas:</p>
            <ul>
                <li>âœ… Cluster names must be non-empty</li>
                <li>âœ… Port numbers must be 1-65535</li>
                <li>âœ… Must specify either <code>host</code> OR <code>nodes</code>, not both</li>
                <li>âœ… DN format validation</li>
                <li>âœ… No duplicate cluster names</li>
            </ul>

            <h3>API Input Validation</h3>
            <p>FastAPI with Pydantic validates all API inputs:</p>
            <ul>
                <li>âœ… Required fields enforced</li>
                <li>âœ… Type checking (string, int, bool, etc.)</li>
                <li>âœ… Format validation (email, DN, etc.)</li>
                <li>âœ… Automatic 422 error on invalid input</li>
            </ul>

            <h2>6. Timeout Protection</h2>

            <h3>LDAP Operation Timeouts</h3>
            <pre><code># Network timeout: 30 seconds
# Operation timeout: 30 seconds</code></pre>

            <p><strong>Purpose:</strong></p>
            <ul>
                <li>Prevents hung connections from blocking application</li>
                <li>Protects against slow loris attacks</li>
                <li>Ensures responsive user experience</li>
            </ul>

            <h2>7. Audit Logging</h2>

            <h3>Operations Logged</h3>
            <ul>
                <li><strong>CREATE:</strong> INFO level with cluster, DN, operation</li>
                <li><strong>UPDATE:</strong> INFO level with modified attributes</li>
                <li><strong>DELETE:</strong> WARNING level (higher visibility)</li>
                <li><strong>AUTH:</strong> Connection attempts and failures</li>
            </ul>

            <h3>Log Format</h3>
            <pre><code>{
  "timestamp": "2024-01-25T10:30:45.123Z",
  "level": "WARNING",
  "logger": "app.api.entries",
  "message": "LDAP entry deleted",
  "cluster": "production",
  "dn": "cn=olduser,dc=example,dc=com",
  "operation": "DELETE",
  "operator": "admin"
}</code></pre>

            <h3>Security Properties</h3>
            <ul>
                <li>âœ… Complete audit trail</li>
                <li>âœ… Tamper-evident (append-only logs)</li>
                <li>âœ… Searchable JSON format</li>
                <li>âœ… Includes context (cluster, DN, operation)</li>
            </ul>

            <h2>Security Testing</h2>

            <h3>Automated Security Tests</h3>
            <p>Comprehensive test suite includes security-specific tests:</p>
            <ul>
                <li><strong>24 tests</strong> - Password encryption and cache security</li>
                <li><strong>5 tests</strong> - LDAP injection protection</li>
                <li><strong>8 tests</strong> - Authentication and authorization</li>
                <li><strong>6 tests</strong> - Configuration validation</li>
            </ul>

            <h3>Test Coverage</h3>
            <pre><code># Run security tests
cd backend
pytest tests/test_password_cache.py -v
pytest tests/test_api_entries.py::TestSearchEndpoint::test_search_ldap_injection_protected -v</code></pre>

            <h2>Security Best Practices</h2>

            <h3>Production Deployment</h3>
            <ol>
                <li><strong>HTTPS Only:</strong> Always use HTTPS in production (reverse proxy required)</li>
                <li><strong>CORS Configuration:</strong> Set <code>ALLOWED_ORIGINS</code> to your production domain</li>
                <li><strong>Strong Passwords:</strong> Use complex LDAP bind passwords</li>
                <li><strong>Regular Updates:</strong> Keep Docker images up to date</li>
                <li><strong>Network Isolation:</strong> Run in private network when possible</li>
                <li><strong>Firewall Rules:</strong> Restrict access to LDAP ports (389/636)</li>
            </ol>

            <h3>Monitoring</h3>
            <ol>
                <li>Monitor health check endpoint: <code>/health</code></li>
                <li>Set up alerts for authentication failures</li>
                <li>Review audit logs regularly</li>
                <li>Monitor for unusual access patterns</li>
            </ol>

            <h3>Backup & Recovery</h3>
            <ol>
                <li>Backup <code>config.yml</code> regularly</li>
                <li>Backup <code>/app/.secrets/</code> volume (encryption key)</li>
                <li>Document disaster recovery procedures</li>
                <li>Test backup restoration periodically</li>
            </ol>

            <h2>Vulnerability Reporting</h2>
            <p>If you discover a security vulnerability, please report it responsibly:</p>
            <ul>
                <li>Email: <a href="mailto:security@vibhuvioio.com">security@vibhuvioio.com</a></li>
                <li>GitHub: <a href="https://github.com/vibhuvioio/ldap-manager/security/advisories/new">Private Security Advisory</a></li>
                <li>Please do not create public issues for security vulnerabilities</li>
            </ul>

            <h2>Compliance & Standards</h2>
            <ul>
                <li>âœ… OWASP Top 10 2021 - No known vulnerabilities</li>
                <li>âœ… LDAP RFC 4511 - Protocol compliance</li>
                <li>âœ… RFC 2696 - Server-side pagination</li>
                <li>âœ… CWE-90 - LDAP injection prevention</li>
                <li>âœ… CWE-312 - Cleartext password storage prevention</li>
            </ul>

            <h2>Resources</h2>
            <ul>
                <li><a href="https://github.com/vibhuvioio/ldap-manager/blob/main/PRODUCTION_READY.md">PRODUCTION_READY.md</a> - Security implementation details</li>
                <li><a href="production.html">Production Deployment Guide</a> - Security configuration</li>
                <li><a href="https://owasp.org/www-project-top-ten/">OWASP Top 10</a> - Web application security risks</li>
                <li><a href="https://cwe.mitre.org/data/definitions/90.html">CWE-90: LDAP Injection</a></li>
            </ul>

            <footer class="docs-footer">
                <p>Security is our top priority. Deploy LDAP Manager with confidence! ðŸ”’</p>
            </footer>
        </main>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>LDAP Manager</h4>
                    <p>Secure web interface for OpenLDAP</p>
                </div>
                <div class="footer-section">
                    <h4>Links</h4>
                    <a href="https://github.com/vibhuvioio/ldap-manager">GitHub</a>
                    <a href="getting-started.html">Documentation</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Developed by <a href="https://vibhuvioio.com" target="_blank">Vibhuvi OiO</a> â€¢ Founded by <a href="https://jinnabalu.com" target="_blank">Jinna Baalu</a></p>
            </div>
        </div>
    </footer>
</body>
</html>
