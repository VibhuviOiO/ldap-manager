<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WCRSK785');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Deployment - LDAP Manager</title>
    <meta name="description" content="Production-grade deployment guide for LDAP Manager with enterprise security, load balancing, monitoring, and high availability features.">
    <meta name="keywords" content="ldap production deployment, ldap security, ldap load balancing, ldap monitoring, ldap high availability">
    <link rel="canonical" href="https://vibhuvioio.com/ldap-manager/production.html">
    <link rel="icon" type="image/x-icon" href="img/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="docs.css">
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WCRSK785"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="nav-brand" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 12px;">
                <img src="img/ldap.png" alt="LDAP Manager" style="height: 40px; width: auto;">
                <span class="brand-name">LDAP Manager</span>
            </a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="getting-started.html">Docs</a>
                <a href="https://github.com/VibhuviOiO/ldap-manager" target="_blank">GitHub</a>
            </div>
        </div>
    </nav>

    <div class="docs-layout">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h3>Getting Started</h3>
                    <a href="getting-started.html">Installation</a>
                    <a href="configuration.html">Configuration</a>
                </div>
                <div class="nav-section">
                    <h3>Features</h3>
                    <a href="features.html">Overview</a>
                    <a href="security.html">Security</a>
                </div>
                <div class="nav-section">
                    <h3>Deployment</h3>
                    <a href="production.html" class="active">Production Guide</a>
                </div>
                <div class="nav-section">
                    <h3>Contributing</h3>
                    <a href="development.html">Development</a>
                    <a href="testing.html">Testing Guide</a>
                </div>
            </nav>
        </aside>

        <main class="docs-content">
            <h1>Production Deployment Guide</h1>
            <p>LDAP Manager is production-ready with enterprise-grade security, high availability, and comprehensive monitoring capabilities.</p>

            <div class="note" style="background: #d4edda; border-left: 4px solid #28a745; padding: 16px; margin: 24px 0;">
                <strong>‚úÖ Production Ready:</strong> All security, reliability, and observability features have been implemented and tested.
            </div>

            <h2>Production Features Overview</h2>

            <h3>üîí Security</h3>
            <ul>
                <li><strong>Encrypted Password Storage</strong> - Fernet symmetric encryption with 1-hour TTL</li>
                <li><strong>LDAP Injection Protection</strong> - All user input is escaped and validated</li>
                <li><strong>CORS Security</strong> - Environment-based origin whitelist</li>
                <li><strong>Non-Root Container</strong> - Runs as user <code>ldapmanager:1000</code></li>
                <li><strong>Secure File Permissions</strong> - 0600 for cache and secrets</li>
            </ul>

            <h3>‚ö° High Availability</h3>
            <ul>
                <li><strong>Load Balancing</strong> - Intelligent node selection (READ: last‚Üífirst, WRITE: first only)</li>
                <li><strong>Automatic Failover</strong> - 2-second connectivity checks with fallback chain</li>
                <li><strong>Connection Pooling</strong> - 5-minute TTL with automatic cleanup</li>
                <li><strong>Multi-Master Support</strong> - Full N-way replication cluster support</li>
            </ul>

            <h3>üìä Observability</h3>
            <ul>
                <li><strong>Structured JSON Logging</strong> - Timestamp, level, module, function context</li>
                <li><strong>Audit Trail</strong> - All CREATE/UPDATE/DELETE operations logged</li>
                <li><strong>Request Metrics</strong> - Duration, status code, path tracking</li>
                <li><strong>Health Checks</strong> - Config validation, pool status, LDAP connectivity</li>
            </ul>

            <h3>üß™ Quality Assurance</h3>
            <ul>
                <li><strong>104 Backend Tests</strong> - 97% pass rate with comprehensive coverage</li>
                <li><strong>Security Testing</strong> - Encryption, injection, authentication tests</li>
                <li><strong>Integration Testing</strong> - API endpoints, LDAP operations</li>
                <li><strong>Configuration Validation</strong> - Pydantic schema validation at startup</li>
            </ul>

            <h2>Production Deployment</h2>

            <h3>Step 1: Environment Configuration</h3>
            <p>Create a <code>.env</code> file with production settings:</p>
            <pre><code># CORS Security - Whitelist your domain
ALLOWED_ORIGINS=https://ldap.company.com,https://ldap-backup.company.com

# Logging
LOG_LEVEL=INFO
JSON_LOGS=true

# Server
PORT=8000
WORKERS=4</code></pre>

            <h3>Step 2: Docker Compose Production Setup</h3>
            <p>Use the production-hardened Docker Compose configuration:</p>
            <pre><code>version: '3.8'

services:
  ldap-manager:
    image: ghcr.io/vibhuvioio/ldap-manager:latest
    restart: unless-stopped

    env_file: .env

    volumes:
      - ./config.yml:/app/config.yml:ro
      - ldap-cache:/app/.cache
      - ldap-secrets:/app/.secrets

    ports:
      - "5173:5173"  # Frontend
      - "8000:8000"  # Backend API

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 256M

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

    security_opt:
      - no-new-privileges:true

volumes:
  ldap-cache:
    driver: local
  ldap-secrets:
    driver: local</code></pre>

            <h3>Step 3: Start the Application</h3>
            <pre><code>docker-compose -f docker-compose.prod.yml up -d</code></pre>

            <h3>Step 4: Verify Health</h3>
            <pre><code>curl http://localhost:8000/health | jq</code></pre>

            <p>Expected response:</p>
            <pre><code>{
  "status": "healthy",
  "timestamp": "2024-01-25T10:30:00Z",
  "version": "1.0.0",
  "checks": {
    "config": {"status": "ok", "clusters_count": 4},
    "connection_pool": {"status": "ok", "pool_size": 2},
    "ldap": {"status": "ok", "cluster": "production"}
  }
}</code></pre>

            <h2>Load Balancing Strategy</h2>

            <h3>Read Operations (Searches, Stats, Groups)</h3>
            <p>Uses <strong>reverse node order</strong> to distribute load:</p>
            <ol>
                <li>Try last node (least loaded)</li>
                <li>Fallback to second node</li>
                <li>Fallback to first node</li>
            </ol>
            <p><strong>Example:</strong> 3-node cluster ‚Üí 33% load per node instead of 100% on first node</p>

            <h3>Write Operations (Create, Update, Delete)</h3>
            <p>Always use <strong>first node</strong> (primary master) for consistency.</p>

            <h3>Automatic Failover</h3>
            <p>Each node is tested with a 2-second socket connectivity check. If unreachable, the next node in the chain is tried automatically.</p>

            <h2>Security Best Practices</h2>

            <h3>Password Encryption</h3>
            <p>Passwords are encrypted at rest using Fernet symmetric encryption:</p>
            <ul>
                <li><strong>Algorithm:</strong> AES-128 in CBC mode with HMAC</li>
                <li><strong>Key Storage:</strong> <code>/app/.secrets/encryption.key</code> with 0600 permissions</li>
                <li><strong>TTL:</strong> 1 hour default (configurable)</li>
                <li><strong>Auto-Expiration:</strong> Expired passwords are deleted automatically</li>
            </ul>

            <h3>LDAP Injection Prevention</h3>
            <p>All user input in search queries is escaped using <code>ldap.filter.escape_filter_chars()</code>:</p>
            <pre><code># User input: *)(objectClass=*
# After escaping: \2a\29\28objectClass=\2a
# Result: Harmless literal search, not filter injection</code></pre>

            <h3>CORS Configuration</h3>
            <p>Configure allowed origins in production:</p>
            <pre><code>ALLOWED_ORIGINS=https://ldap.company.com</code></pre>
            <p>Never use <code>*</code> in production with credentials enabled.</p>

            <h2>Monitoring & Logging</h2>

            <h3>Structured Logs</h3>
            <p>All logs are output in JSON format for easy parsing:</p>
            <pre><code>{
  "timestamp": "2024-01-25T10:30:45.123Z",
  "level": "INFO",
  "logger": "app.api.entries",
  "message": "LDAP entry created",
  "module": "entries",
  "function": "create_entry",
  "line": 275,
  "cluster": "production",
  "dn": "cn=newuser,dc=example,dc=com",
  "operation": "CREATE"
}</code></pre>

            <h3>Viewing Logs</h3>
            <pre><code># Follow logs in real-time
docker logs -f ldap-manager

# Last 100 lines
docker logs --tail 100 ldap-manager

# Search for errors
docker logs ldap-manager | grep '"level":"ERROR"'</code></pre>

            <h3>Health Monitoring</h3>
            <pre><code># Check health endpoint
curl http://localhost:8000/health

# Monitor with watch
watch -n 5 'curl -s http://localhost:8000/health | jq .status'</code></pre>

            <h2>Performance Optimizations</h2>

            <h3>Connection Pooling</h3>
            <ul>
                <li><strong>Before:</strong> ~500ms per request (new connection)</li>
                <li><strong>After:</strong> ~10ms per request (pooled connection)</li>
                <li><strong>TTL:</strong> 5 minutes</li>
                <li><strong>Cleanup:</strong> Automatic stale connection removal</li>
            </ul>

            <h3>Server-Side Pagination</h3>
            <ul>
                <li><strong>Protocol:</strong> RFC 2696 Simple Paged Results</li>
                <li><strong>Performance:</strong> 10-100x improvement for large directories</li>
                <li><strong>Memory:</strong> Constant memory usage regardless of directory size</li>
            </ul>

            <h3>Request Timeouts</h3>
            <ul>
                <li><strong>Network Timeout:</strong> 30 seconds</li>
                <li><strong>Operation Timeout:</strong> 30 seconds</li>
                <li><strong>Purpose:</strong> Prevents hung connections from blocking application</li>
            </ul>

            <h2>Backup & Recovery</h2>

            <h3>Configuration Backup</h3>
            <pre><code># Backup config.yml
cp config.yml config.yml.backup.$(date +%Y%m%d)

# Backup persistent volumes
docker run --rm -v ldap-secrets:/data -v $(pwd):/backup alpine tar czf /backup/secrets-backup.tar.gz -C /data .</code></pre>

            <h3>Password Cache Recovery</h3>
            <p>If password cache is lost, users will be prompted to re-enter passwords on next connection. Passwords are re-cached automatically.</p>

            <h2>Troubleshooting</h2>

            <h3>Connection Failures</h3>
            <pre><code># Check LDAP server connectivity
docker exec ldap-manager curl -v telnet://192.168.0.101:389

# Check logs for connection errors
docker logs ldap-manager | grep "connection failed"</code></pre>

            <h3>Password Cache Issues</h3>
            <pre><code># Check cache status
curl http://localhost:8000/api/password/check/your-cluster

# Clear specific cluster cache
curl -X DELETE http://localhost:8000/api/password/cache/your-cluster</code></pre>

            <h3>Health Check Failures</h3>
            <pre><code># Detailed health status
curl http://localhost:8000/health | jq

# Check specific component
curl http://localhost:8000/health | jq '.checks.ldap'</code></pre>

            <h2>Upgrade Guide</h2>

            <h3>Zero-Downtime Upgrade</h3>
            <pre><code># Pull latest image
docker pull ghcr.io/vibhuvioio/ldap-manager:latest

# Restart with new image
docker-compose -f docker-compose.prod.yml up -d

# Verify health
curl http://localhost:8000/health</code></pre>

            <h3>Rollback</h3>
            <pre><code># Use specific version
docker-compose -f docker-compose.prod.yml down
docker pull ghcr.io/vibhuvioio/ldap-manager:v1.0.0
docker-compose -f docker-compose.prod.yml up -d</code></pre>

            <h2>Production Checklist</h2>

            <div class="note">
                <strong>Before Going Live:</strong>
                <ul style="list-style: none; padding-left: 0;">
                    <li>‚òëÔ∏è CORS configured with production domain(s)</li>
                    <li>‚òëÔ∏è HTTPS/TLS enabled (reverse proxy required)</li>
                    <li>‚òëÔ∏è Persistent volumes mounted for cache and secrets</li>
                    <li>‚òëÔ∏è Resource limits configured (CPU, memory)</li>
                    <li>‚òëÔ∏è Health check endpoint monitored</li>
                    <li>‚òëÔ∏è Log aggregation configured (Elasticsearch, CloudWatch, etc.)</li>
                    <li>‚òëÔ∏è Backup strategy for config.yml</li>
                    <li>‚òëÔ∏è Alerting configured for health check failures</li>
                    <li>‚òëÔ∏è All LDAP servers reachable from container</li>
                    <li>‚òëÔ∏è Firewall rules allow LDAP ports (389/636)</li>
                </ul>
            </div>

            <h2>Support & Resources</h2>
            <ul>
                <li><a href="https://github.com/vibhuvioio/ldap-manager/issues">GitHub Issues</a> - Bug reports and feature requests</li>
                <li><a href="https://github.com/vibhuvioio/ldap-manager/blob/main/PRODUCTION_READY.md">PRODUCTION_READY.md</a> - Detailed implementation documentation</li>
                <li><a href="security.html">Security Guide</a> - Security features and best practices</li>
                <li><a href="configuration.html">Configuration Guide</a> - Cluster setup and options</li>
            </ul>

            <footer class="docs-footer">
                <p>LDAP Manager is production-ready and actively maintained. Deploy with confidence! üöÄ</p>
            </footer>
        </main>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>LDAP Manager</h4>
                    <p>Production-ready web interface for OpenLDAP</p>
                </div>
                <div class="footer-section">
                    <h4>Links</h4>
                    <a href="https://github.com/vibhuvioio/ldap-manager">GitHub</a>
                    <a href="getting-started.html">Documentation</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Developed by <a href="https://vibhuvioio.com" target="_blank">Vibhuvi OiO</a></p>
            </div>
        </div>
    </footer>
</body>
</html>
