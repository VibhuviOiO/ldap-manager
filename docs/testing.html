<!DOCTYPE html>
<html lang="en">
<head>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PX6NFGMV');</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing Guide - LDAP Manager</title>
    <meta name="description" content="Complete testing guide for LDAP Manager: E2E testing with Playwright, test coverage, and running tests.">
    <link rel="canonical" href="https://vibhuvioio.com/ldap-manager/testing.html">
    <link rel="icon" type="image/x-icon" href="img/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="docs.css">
</head>
<body>
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PX6NFGMV" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="nav-brand" style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 12px;">
                <img src="img/ldap.png" alt="LDAP Manager" style="height: 40px; width: auto;">
                <span class="brand-name">LDAP Manager</span>
            </a>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="getting-started.html">Docs</a>
                <a href="https://github.com/VibhuviOiO/ldap-manager" target="_blank">GitHub</a>
            </div>
        </div>
    </nav>

    <div class="docs-layout">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h3>Getting Started</h3>
                    <a href="getting-started.html">Installation</a>
                    <a href="configuration.html">Configuration</a>
                </div>
                <div class="nav-section">
                    <h3>Features</h3>
                    <a href="features.html">Overview</a>
                    <a href="security.html">Security</a>
                </div>
                <div class="nav-section">
                    <h3>Deployment</h3>
                    <a href="production.html">Production Guide</a>
                </div>
                <div class="nav-section">
                    <h3>Contributing</h3>
                    <a href="development.html">Development Guide</a>
                    <a href="testing.html" class="active">Testing Guide</a>
                </div>
            </nav>
        </aside>

        <main class="docs-content">
            <h1>Testing Guide</h1>
            <p>Comprehensive guide to testing LDAP Manager with backend unit tests and frontend E2E tests.</p>

            <h2>Test Coverage Overview</h2>
            <p>LDAP Manager has <strong>199 total tests</strong> with comprehensive coverage across backend and frontend.</p>

            <h3>Test Statistics</h3>
            <ul>
                <li><strong>Backend Tests:</strong> 104 tests (97% pass rate, >80% code coverage target)</li>
                <li><strong>Frontend E2E Tests:</strong> 95 tests (100% pass rate)</li>
                <li><strong>Total:</strong> 199 tests</li>
                <li><strong>Browsers:</strong> Chrome, Firefox, Safari (E2E)</li>
                <li><strong>Coverage:</strong> Security, LDAP operations, API endpoints, UI workflows</li>
            </ul>

            <h2>Backend Testing</h2>

            <h3>Running Backend Tests</h3>
            <pre><code>cd backend

# Install test dependencies
pip install -r requirements-test.txt

# Run all tests with coverage
pytest --cov=app --cov-report=html --cov-report=term-missing

# Run specific test file
pytest tests/test_password_cache.py -v

# Run with verbose output
pytest -v

# View HTML coverage report
open htmlcov/index.html</code></pre>

            <h3>Backend Test Suite (104 tests)</h3>

            <h4>Password Cache Tests (24 tests)</h4>
            <ul>
                <li>Fernet encryption key generation and storage</li>
                <li>Password encryption and decryption</li>
                <li>TTL expiration and automatic cleanup</li>
                <li>Cache file permissions (0600)</li>
                <li>Multi-cluster password isolation</li>
            </ul>

            <h4>Node Selector Tests (19 tests)</h4>
            <ul>
                <li>READ operations use last→second→first node order</li>
                <li>WRITE operations always use first node</li>
                <li>Automatic failover on node failure</li>
                <li>Socket connectivity checks</li>
                <li>Single-node cluster handling</li>
            </ul>

            <h4>LDAP Client Tests (20 tests)</h4>
            <ul>
                <li>Connection and authentication</li>
                <li>Search operations with pagination</li>
                <li>Add, modify, delete operations</li>
                <li>Group membership management</li>
                <li>Error handling and timeouts</li>
            </ul>

            <h4>API Endpoints Tests (25 tests)</h4>
            <ul>
                <li>LDAP injection protection</li>
                <li>Authentication and authorization</li>
                <li>Entry CRUD operations</li>
                <li>Group membership endpoints</li>
                <li>Read-only cluster enforcement</li>
            </ul>

            <h4>Connection Pool Tests (15 tests)</h4>
            <ul>
                <li>Connection reuse and TTL</li>
                <li>Stale connection cleanup</li>
                <li>Thread safety</li>
                <li>Pool statistics</li>
            </ul>

            <h4>Configuration Validation Tests (25+ tests)</h4>
            <ul>
                <li>Pydantic schema validation</li>
                <li>Port range validation</li>
                <li>Host/nodes XOR constraint</li>
                <li>Duplicate cluster name detection</li>
            </ul>

            <h3>Security Testing</h3>
            <p>Dedicated tests for security features:</p>
            <ul>
                <li>✅ Password never stored in plaintext</li>
                <li>✅ LDAP injection attempts blocked</li>
                <li>✅ Invalid credentials handled properly</li>
                <li>✅ TTL expiration enforced</li>
                <li>✅ File permissions verified</li>
            </ul>

            <h2>Frontend E2E Testing</h2>

            <h3>Running E2E Tests</h3>
            <pre><code>cd frontend

# Install dependencies
npm install

# Run E2E tests (all browsers)
npx playwright test

# Run in headed mode (watch tests run)
npx playwright test --headed

# Run specific test file
npx playwright test tests/e2e/dashboard.spec.ts

# Run in specific browser
npx playwright test --project=chromium</code></pre>

            <h3>Frontend Test Categories (95 tests)</h3>

            <h3>Dashboard Tests (5 tests)</h3>
            <ul>
                <li>Cluster listing display</li>
                <li>Navigation to cluster details</li>
                <li>Health status indicators</li>
                <li>Cluster information display</li>
            </ul>

            <h3>Cluster Details Tests (8 tests)</h3>
            <ul>
                <li>View switching (Users, Groups, OUs, All)</li>
                <li>Search functionality</li>
                <li>Pagination controls</li>
                <li>Entry display</li>
            </ul>

            <h3>User Creation Tests (7 tests)</h3>
            <ul>
                <li>Form validation</li>
                <li>Custom fields display</li>
                <li>Dropdown options</li>
                <li>Auto-fill fields</li>
                <li>Required field validation</li>
            </ul>

            <h3>Column Settings Tests (4 tests)</h3>
            <ul>
                <li>Show/hide columns</li>
                <li>localStorage persistence</li>
                <li>Default visibility</li>
                <li>Settings dialog</li>
            </ul>

            <h3>User Lifecycle Tests (3 tests)</h3>
            <ul>
                <li>Create user</li>
                <li>Verify user exists</li>
                <li>Delete user</li>
            </ul>

            <h3>User Edit Tests (11 tests)</h3>
            <ul>
                <li>Field updates</li>
                <li>Validation</li>
                <li>Disabled fields (uid, uidNumber)</li>
                <li>Save changes</li>
            </ul>

            <h3>Password Change Tests (11 tests)</h3>
            <ul>
                <li>Policy validation</li>
                <li>Confirmation matching</li>
                <li>shadowLastChange update</li>
                <li>Error handling</li>
            </ul>

            <h3>Complete Lifecycle Tests (5 tests)</h3>
            <ul>
                <li>Create → Edit → Password Change → Delete</li>
                <li>Full user workflow</li>
            </ul>

            <h2>Setup</h2>

            <h3>Prerequisites</h3>
            <ul>
                <li>Node.js 20+</li>
                <li>LDAP Manager running locally</li>
                <li>Test LDAP server configured</li>
            </ul>

            <h3>Install Playwright</h3>
            <pre><code>cd frontend
npm install
npx playwright install</code></pre>

            <p>This installs Playwright and downloads browser binaries (Chrome, Firefox, Safari).</p>

            <h2>Running Tests</h2>

            <h3>Run All Tests</h3>
            <pre><code>npx playwright test</code></pre>

            <h3>Run Specific Browser</h3>
            <pre><code># Chrome only
npx playwright test --project=chromium

# Firefox only
npx playwright test --project=firefox

# Safari only
npx playwright test --project=webkit</code></pre>

            <h3>Run Specific Test File</h3>
            <pre><code>npx playwright test user-lifecycle.spec.ts</code></pre>

            <h3>Run with UI (Interactive Mode)</h3>
            <pre><code>npx playwright test --ui</code></pre>

            <p>Opens Playwright UI for interactive test running and debugging.</p>

            <h3>Run in Headed Mode (See Browser)</h3>
            <pre><code>npx playwright test --headed</code></pre>

            <h3>View HTML Report</h3>
            <pre><code>npx playwright show-report</code></pre>

            <h2>Test Organization</h2>

            <pre><code>frontend/tests/e2e/
├── dashboard.spec.ts                # Dashboard tests (5)
├── cluster-details.spec.ts          # Cluster view tests (8)
├── user-creation.spec.ts            # Form UI tests (7)
├── user-creation-simple.spec.ts     # Form validation (3)
├── column-settings.spec.ts          # Column preferences (4)
├── user-lifecycle.spec.ts           # Full E2E lifecycle (3)
├── user-edit.spec.ts                # Edit functionality (11)
├── password-change.spec.ts          # Password change (11)
└── user-lifecycle-complete.spec.ts  # Complete workflow (5)</code></pre>

            <h2>Writing Tests</h2>

            <h3>Example Test</h3>
            <pre><code>import { test, expect } from '@playwright/test';

test('should display cluster list', async ({ page }) => {
  await page.goto('http://localhost:5173');
  
  // Check if clusters are displayed
  await expect(page.locator('.cluster-card')).toBeVisible();
  
  // Verify cluster name
  await expect(page.locator('text=Production LDAP')).toBeVisible();
});</code></pre>

            <h3>Test Structure</h3>
            <pre><code>test.describe('Feature Name', () => {
  test.beforeEach(async ({ page }) => {
    // Setup before each test
    await page.goto('http://localhost:5173');
  });

  test('should do something', async ({ page }) => {
    // Test implementation
  });

  test.afterEach(async ({ page }) => {
    // Cleanup after each test
  });
});</code></pre>

            <h2>Test Configuration</h2>

            <h3>playwright.config.ts</h3>
            <pre><code>import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:5173',
    trace: 'on-first-retry',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
  ],
});</code></pre>

            <h2>Debugging Tests</h2>

            <h3>Debug Mode</h3>
            <pre><code>npx playwright test --debug</code></pre>

            <p>Opens Playwright Inspector for step-by-step debugging.</p>

            <h3>Pause Test</h3>
            <pre><code>test('debug test', async ({ page }) => {
  await page.goto('http://localhost:5173');
  await page.pause(); // Pauses execution
  // Continue debugging in browser
});</code></pre>

            <h3>Screenshots on Failure</h3>
            <pre><code>use: {
  screenshot: 'only-on-failure',
  video: 'retain-on-failure',
}</code></pre>

            <h2>CI/CD Integration</h2>

            <h3>GitHub Actions Example</h3>
            <pre><code>name: Playwright Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 20
      - name: Install dependencies
        run: cd frontend && npm ci
      - name: Install Playwright
        run: cd frontend && npx playwright install --with-deps
      - name: Run tests
        run: cd frontend && npx playwright test
      - uses: actions/upload-artifact@v3
        if: always()
        with:
          name: playwright-report
          path: frontend/playwright-report/</code></pre>

            <h2>Best Practices</h2>

            <h3>Test Writing</h3>
            <ul>
                <li>Use descriptive test names</li>
                <li>Keep tests independent</li>
                <li>Clean up test data</li>
                <li>Use page object pattern for complex pages</li>
                <li>Avoid hard-coded waits</li>
            </ul>

            <h3>Selectors</h3>
            <ul>
                <li>Prefer data-testid attributes</li>
                <li>Use role-based selectors</li>
                <li>Avoid CSS selectors that may change</li>
                <li>Use text content for stable elements</li>
            </ul>

            <h3>Example: Good Selectors</h3>
            <pre><code>// Good - data-testid
await page.locator('[data-testid="create-user-button"]').click();

// Good - role
await page.getByRole('button', { name: 'Create User' }).click();

// Good - text
await page.locator('text=Create User').click();

// Bad - CSS class (may change)
await page.locator('.btn-primary').click();</code></pre>

            <h2>Test Data Management</h2>

            <h3>Test User Creation</h3>
            <pre><code>const testUser = {
  uid: `testuser_${Date.now()}`,
  cn: 'Test User',
  mail: 'test@example.com',
  password: 'Test123!@#'
};

// Create user
await createUser(page, testUser);

// Verify user
await expect(page.locator(`text=${testUser.uid}`)).toBeVisible();

// Cleanup
await deleteUser(page, testUser.uid);</code></pre>

            <h2>Performance Testing</h2>

            <h3>Measure Page Load</h3>
            <pre><code>test('page load performance', async ({ page }) => {
  const start = Date.now();
  await page.goto('http://localhost:5173');
  const loadTime = Date.now() - start;
  
  expect(loadTime).toBeLessThan(3000); // 3 seconds
});</code></pre>

            <h2>Accessibility Testing</h2>

            <h3>Install axe-playwright</h3>
            <pre><code>npm install --save-dev @axe-core/playwright</code></pre>

            <h3>Run Accessibility Tests</h3>
            <pre><code>import { test, expect } from '@playwright/test';
import { injectAxe, checkA11y } from '@axe-core/playwright';

test('should not have accessibility violations', async ({ page }) => {
  await page.goto('http://localhost:5173');
  await injectAxe(page);
  await checkA11y(page);
});</code></pre>

            <h2>Troubleshooting</h2>

            <h3>Tests Failing Locally</h3>
            <ul>
                <li>Ensure LDAP Manager is running</li>
                <li>Check LDAP server is accessible</li>
                <li>Verify config.yml is correct</li>
                <li>Clear browser cache</li>
                <li>Update Playwright browsers</li>
            </ul>

            <h3>Flaky Tests</h3>
            <ul>
                <li>Add proper waits for elements</li>
                <li>Use <code>waitForLoadState</code></li>
                <li>Increase timeout for slow operations</li>
                <li>Check for race conditions</li>
            </ul>

            <h3>Update Browsers</h3>
            <pre><code>npx playwright install</code></pre>

            <h2>Resources</h2>
            <ul>
                <li><a href="https://playwright.dev/" target="_blank">Playwright Documentation</a></li>
                <li><a href="https://playwright.dev/docs/best-practices" target="_blank">Playwright Best Practices</a></li>
                <li><a href="https://playwright.dev/docs/debug" target="_blank">Debugging Guide</a></li>
                <li><a href="https://playwright.dev/docs/ci" target="_blank">CI/CD Integration</a></li>
            </ul>

            <h2>Next Steps</h2>
            <ul>
                <li><a href="development.html">Learn about development setup</a></li>
                <li><a href="features.html">Explore all features</a></li>
                <li><a href="https://github.com/VibhuviOiO/ldap-manager" target="_blank">Contribute on GitHub</a></li>
            </ul>
        </main>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>Developed by <a href="https://vibhuvioio.com" target="_blank">Vibhuvi OiO</a></p>
                <p class="footer-message">Giving back through open source</p>
            </div>
        </div>
    </footer>
</body>
</html>
